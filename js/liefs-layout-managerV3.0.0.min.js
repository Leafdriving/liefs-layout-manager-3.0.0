function html(...e){let t=new HtmlBlock("",...e);return t.label=HtmlBlock.defaults.label(),t}function events(...arguments){return new Events(...arguments)}function I(...e){let t=new HtmlBlock(...e);return t.dim?new DisplayCell(t,t.dim):new DisplayCell(t)}function h(...e){let t=new DisplayCell(new DisplayGroup(...e));return t.displaygroup.dim&&(t.dim=t.displaygroup.dim),t}function v(...e){let t=new DisplayCell(new DisplayGroup(!1,...e));return t.displaygroup.dim&&(t.dim=t.displaygroup.dim),t}function H(...e){return new Handler(...e)}function css(...e){return new Css(...e)}function P(...arguments){let e=new DisplayCell(new Pages(...arguments));return e.pages.dim&&(e.dim=e.pages.dim),e}function swipe(...e){let t=new Swipe(...e),l={onMove:function(e){let l=this;t.left&&e.x<-t.swipeDistance&&(t.left(),l.reset()),t.right&&e.x>t.swipeDistance&&(t.right(),l.reset()),t.up&&e.y<-t.swipeDistance&&(t.up(),l.reset()),t.down&&e.y>t.swipeDistance&&(t.down(),l.reset())}};return l}function dragbar(...e){let t=new Overlay("DragBar",...e),l=t.returnObj,s=l.parentDisplaycell;return s.addOverlay(t),s}function T(...e){return new TreeNode(...e)}function props(...e){return new Props(...e)}function tree(...e){let t=new Overlay("Tree",...e),l=t.returnObj,s=l.parentDisplayCell;return s.addOverlay(t),s}function TI(...e){let t,l,s;for(let s=0;s<e.length;s++)t=e[s],pf.isArray(t)&&(l=t,e.splice(s,1),s-=1);let i=Tree.i(...e);return s=l?Tree.t(i,l):Tree.t(i),s}class mf{static modifyClassProperties(e,t){for(let l of Object.keys(e))"function"==typeof e[l]&&"label"==l?t[l]=e[l]():t[l]=e[l]}static applyArguments(e,t,l,s,i,r=[]){let n=pf.sortArgs(t,e,r),o=pf.ifObjectMergeWithDefaults(n,l),a=pf.retArgsMapped(n,o,s);mf.modifyClassProperties(a,i)}}class pf{static errorHandling(e){console.log(`Error Handeling Called\n${e}`)}static commonKeys(e,t){let l=[];for(let s in e)s in t&&l.push(s);return l}static retArgsMapped(e,t,l){let s,i={};for(let e in t)i[e]=t[e];for(let t in e)if(t in l)for(s=0;s<e[t].length&&s<l[t].length;)i[l[t][s]]=e[t][s],s++;return i}static ifObjectMergeWithDefaults(e,t){return"object"in e?pf.mergeObjects(t,e.object[0]):t}static sortArgs(e,t="unlabeled",l=[]){l=l.concat(pf.defaultIsChecks);let s,i,r={};for(let t of e){s=typeof t;for(let e of l)i=e(t),i&&(s=i);s in r||(r[s]=[]),r[s].push(t)}return r}static setAttrib(e,t,l){let s=e.getAttribute(t);if(s!=l){let s=document.createAttribute(t);s.value=l,e.setAttributeNode(s)}}static getAttribs(e,t={}){for(let l=0;l<e.attributes.length;l++)t[e.attributes[l].name]=e.attributes[l].value;return t}static elExists(e){return document.getElementById(e)}static viewport(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return[e,t]}static errorReporting(e){console.log("Error Reporting"),console.log(e)}static uis0(e){return null==e?0:e}static concatArray(e,t){for(let l of t)e.push(l)}static parseURLParams(e=window.location.href){let t,l,s,i,r=e.indexOf("?")+1,n=e.indexOf("#")+1||e.length+1,o=e.slice(r,n-1),a=o.replace(/\+/g," ").split("&"),h={};if(o!==e&&""!==o){for(t=0;t<a.length;t++)i=a[t].split("=",2),l=decodeURIComponent(i[0]),s=decodeURIComponent(i[1]),h.hasOwnProperty(l)||(h[l]=[]),h[l].push(2===i.length?s:null);return h}}}pf.isTypePx=function(e){return"string"==typeof e&&"px"==e.substr(-2)},pf.pxAsNumber=function(e){return+e.slice(0,-2)},pf.isTypePercent=function(e){return"string"==typeof e&&"%"==e.substr(-1)},pf.percentAsNumber=function(e){return+e.slice(0,-1)},pf.isDim=function(e){if("string"==typeof e&&("px"==e.substr(-2)||"%"==e.substr(-1)))return"dim"},pf.isArray=function(e){if("object"==typeof e&&Array.isArray(e))return"Array"},pf.isObjectAClass=function(e){if("object"==typeof e&&"Object"!=e.constructor.name)return e.constructor.name},pf.defaultIsChecks=[pf.isArray,pf.isObjectAClass,pf.isDim],pf.classProperties=function(e){return Object.getOwnPropertyNames(e)},pf.pad_with_zeroes=function(e,t=3){let l=""+e;for(;l.length<t;)l="0"+l;return l},pf.mergeObjects=function(e,t){let l={};for(let t in e)l[t]=e[t];for(let e in t)l[e]=t[e];return l};class Point{}class Within{constructor(...e){mf.applyArguments("Within",e,{},{number:["x","y","width","height"]},this)}clipStyleString(e){return Coord.clipStyleString(this,e)}}class Coord{constructor(...e){this.within=new Within,Coord.instances.push(this),mf.applyArguments("Coord",e,Coord.defaults,Coord.argMap,this)}static byLabel(e){for(let t in Coord.instances)if(Coord.instances[t].label==e)return Coord.instances[t]}copyWithin(...e){let t={};mf.applyArguments("Coord.copyWithin",e,{isRoot:!1},Coord.CopyArgMap,t);t.isRoot;if(t.isRoot)for(let e of["x","y","width","height"])this.within[e]=this[e];else if("Coord"in t){let e=t.Coord;for(let t of["x","y","width","height"])this.within[t]=e.within[t];let l=this.x,s=this.y,i=this.width,r=this.height,n=l+i,o=s+r,a=this.within.x,h=this.within.y,c=this.within.width,d=this.within.height,p=a+c,u=h+d,f=l>a?l:a,g=n<p?n:p,y=s>h?s:h,b=o<u?o:u;this.within.x=f,this.within.width=g-f,this.within.y=y,this.within.height=b-y}else console.log("Boo")}copy(...e){let t,l={};mf.applyArguments("Coord.copy",e,{},Coord.CopyArgMap,l),"Within"in l?t=l.Within:"Coord"in l&&(t=l.Coord,this.within=l.Coord.within),t&&(l.left=l.x?l.x:0,l.top=l.y?l.y:0,l.right=l.width?l.width:0,l.bottom=l.height?l.height:0),this.x=t?t.x+l.left:"x"in l?l.x:this.x,this.y=t?t.y+l.top:"y"in l?l.y:this.y,this.width=t?t.width-(l.left+l.right):l.width?l.width:this.width,this.height=t?t.height-(l.top+l.bottom):l.height?l.height:this.height,this.zindex="zindex"in l?l.zindex:Handler.currentZindex}replace(e,t,l,s,i){null!=e&&(this.x=e),null!=t&&(this.y=t),null!=l&&(this.width=l),null!=s&&(this.height=s),null!=i&&(this.zindex=i)}isCoordCompletelyOutside(e=this.within){return e.x+e.width<this.x||e.x>this.x+this.width||e.y+e.height<this.y||e.y>this.y+this.height}derender(e){return e||this.isCoordCompletelyOutside()}clipStyleString(e){return Coord.clipStyleString(this,e)}newClipStyleString(e=this.within){return Coord.clipStyleString(e,this)}static clipStyleString(e,t){let l,s="",i=t.x<e.x?e.x-t.x:0;if(t.hideWidth){let s=document.getElementById(t.label),i=s.getBoundingClientRect();l=t.x+i.width>e.x+e.width?t.x+i.width-(e.x+e.width):0}else l=t.x+t.width>e.x+e.width?t.x+t.width-(e.x+e.width):0;let r=t.y<e.y?e.y-t.y:0,n=t.y+t.height>e.y+e.height?t.y+t.height-(e.y+e.height):0;return i+l+r+n>0&&(s=`clip-path: inset(${r}px ${l}px ${n}px ${i}px);`),s}isPointIn(e,t){return this.x<=e&&e<=this.x+this.width&&this.y<=t&&t<=this.y+this.height}asAttributeString(){return`left: ${this.x}px; top:${this.y}px; width:${this.width}px; height:${this.height}px; `+`z-index:${this.zindex};`}newAsAttributeString(){return`left: ${this.x}px; top:${this.y}px;`+`${this.hideWidth?"":"width:"+this.width+"px; "}`+`height:${this.height}px; z-index:${this.zindex};${this.newClipStyleString()}`}}Coord.instances=[],Coord.defaults={label:function(){return`Coord_${pf.pad_with_zeroes(Coord.instances.length)}`},x:0,y:0,width:0,height:0,zindex:0},Coord.argMap={string:["label"],number:["x","y","width","height","zindex"],boolean:["hideWidth"]},Coord.CopyArgMap={Within:["Within"],Coord:["Coord"],boolean:["isRoot"],number:["x","y","width","height","zindex"]};class HtmlBlock{constructor(...e){this.attributes={},HtmlBlock.instances.push(this);let t=pf.sortArgs(e,"HtmlBlock");mf.applyArguments("HtmlBlock",e,HtmlBlock.defaults,HtmlBlock.argMap,this);let l=document.getElementById(this.label);if(l&&(this.innerHTML=l.innerHTML,this.attributes=pf.getAttribs(l,this.attributes),l.remove()),"Css"in t)for(let e of t.Css)this.css=(this.css+" "+e.classname).trim();if("string"in t&&t.string.length>3&&(this.css+=" "+t.string.splice(3).join(" ")),"number"in t){let e=t.number.length;1==e?this.marginRight=this.marginTop=this.marginBottom=this.marginLeft:2==e&&(this.marginRight=this.marginLeft,this.marginBottom=this.marginTop)}""==this.label.trim()&&(this.label=`htmlBlock_${pf.pad_with_zeroes(HtmlBlock.instances.length)}`)}static byLabel(e){for(let t in HtmlBlock.instances)if(HtmlBlock.instances[t].label==e)return HtmlBlock.instances[t]}}HtmlBlock.instances=[],HtmlBlock.defaults={label:function(){return`htmlBlock_${pf.pad_with_zeroes(HtmlBlock.instances.length)}`},innerHTML:" ",tag:"DIV",css:"",dim:""},HtmlBlock.argMap={string:["label","innerHTML","css"],dim:["dim"],Events:["events"],number:["marginLeft","marginTop","marginRight","marginBottom"],boolean:["hideWidth"]};class Events{constructor(...e){Events.instances.push(this);let t=pf.sortArgs(e,"Events");"object"in t&&(this.actions=t.object[0],delete t.object);let l=pf.ifObjectMergeWithDefaults(t,Events.defaults),s=pf.retArgsMapped(t,l,Events.argMap);mf.modifyClassProperties(s,this)}static byLabel(e){for(let t in Events.instances)if(Events.instances[t].label==e)return Events.instances[t]}applyToHtmlBlock(e){let t=e.el;this.label=e.label;for(let l in this.actions)if("onhold"==l)new Hold(t,this.actions[l]);else if("ondrag"==l)new Drag(t,this.actions[l]);else{let s=this.actions[l];Events.history.push(`document.getElementById("${e.label}").${l} = ${s}`),t[l]=s}}static do(e){console.log(e),console.log(this)}}Events.elementId="llmEvents",Events.instances=[],Events.history=[],Events.defaults={label:function(){return`Events_${pf.pad_with_zeroes(Events.instances.length)}`}},Events.argMap={string:["label"]};class DisplayCell{constructor(...e){this.htmlBlock=void 0,this.displaygroup=void 0,this.overlays=[],this.isRendered=!1,DisplayCell.instances.push(this),mf.applyArguments("DisplayCell",e,DisplayCell.defaults,DisplayCell.argMap,this),this.displaygroup&&this.displaygroup.htmlBlock&&(this.htmlBlock=this.displaygroup.htmlBlock),this.htmlBlock&&(this.label=`${this.htmlBlock.label}`),this.label||(this.label=this.htmlBlock?this.htmlBlock.label+"_DisplayCell":this.displaygroup?this.displaygroup.label+"_DisplayCell":`DisplayCell_${pf.pad_with_zeroes(DisplayCell.instances.length)}`),this.htmlBlock&&this.htmlBlock.hideWidth?this.coord=new Coord(this.label,!0):this.coord=new Coord(this.label)}static byLabel(e){for(let t in DisplayCell.instances)if(DisplayCell.instances[t].label==e)return DisplayCell.instances[t]}addOverlay(e){this.overlays.push(e)}hMenuBar(e){e.launchcell=this,this.htmlBlock.events=events({onmouseover:hMenuBar(e)})}vMenuBar(e){e.launchcell=this,this.htmlBlock.events=events({onmouseover:vMenuBar(e)})}}DisplayCell.instances=[],DisplayCell.minDisplayGroupSize=100,DisplayCell.defaults={dim:""},DisplayCell.argMap={string:["label"],HtmlBlock:["htmlBlock"],DisplayGroup:["displaygroup"],dim:["dim"],Pages:["pages"],function:["preRenderCallback","postRenderCallback"]};class DisplayGroup{constructor(...e){this.cellArray=[],this.htmlBlock=void 0,this.overlay=void 0,DisplayGroup.instances.push(this);let t=pf.sortArgs(e,"DisplayGroup");mf.applyArguments("DisplayGroup",e,DisplayGroup.defaults,DisplayGroup.argMap,this),"DisplayCell"in t&&(this.cellArray=t.DisplayCell),"HtmlBlock"in t&&(this.htmlBlock=t.HtmlBlock[0]),"Array"in t&&(this.cellArray=t.Array[0]),"number"in t&&1==t.number.length&&(this.marginVer=this.marginHor=t.number[0]),this.coord=new Coord(this.label);let l=0,s=0;for(let e of this.cellArray){let t=e.dim;""==t?s++:pf.isTypePercent(t)&&(l+=pf.percentAsNumber(t))}let i=100-l;if(s){let e=String(i/s)+"%";for(let t of this.cellArray)""==t.dim&&(t.dim=e)}}static byLabel(e){for(let t in DisplayGroup.instances)if(DisplayGroup.instances[t].label==e)return DisplayGroup.instances[t]}percentToPx(e){let t=pf.percentAsNumber(e.dim),l=100-t;e.dim=`${this.ishor?e.coord.width:e.coord.height}px`;for(let e=0;e<this.cellArray.length;e++){let s=this.cellArray[e];if(pf.isTypePercent(s.dim)){let e=pf.percentAsNumber(s.dim);e+=e/l*t,s.dim=`${e}%`}}}totalPx(){let e=this.cellArray,t=0;for(let l of e)l.pages&&!l.dim&&(l.dim=l.pages.evalCell().dim),pf.isTypePx(l.dim)&&(t+=pf.pxAsNumber(l.dim));return t}}DisplayGroup.defaultMargins=0,DisplayGroup.instances=[],DisplayGroup.defaults={label:function(){return`DisplayGroup_${pf.pad_with_zeroes(DisplayGroup.instances.length)}`},ishor:!0,marginHor:DisplayGroup.defaultMargins,marginVer:DisplayGroup.defaultMargins},DisplayGroup.argMap={string:["label"],boolean:["ishor"],number:["marginHor","marginVer"],dim:["dim"],Overlay:["overlay"]},DisplayGroup.argCustomTypes=[];class Handler{constructor(...e){this.rootCell=void 0;let t=pf.sortArgs(e,"Handler");if(mf.applyArguments("Handler",e,Handler.defaults,Handler.argMap,this),"DisplayCell"in t?this.rootCell=t.DisplayCell[0]:pf.errorHandling(`Handler "${this.label}" requires a DisplayCell`),null==this.handlerMargin&&(this.handlerMargin=Handler.handlerMarginDefault),Handler.firstRun){setTimeout(Handler.update),Handler.firstRun=!1;for(let e of document.querySelectorAll(Css.deleteOnFirstRunClassname))e.remove();window.onresize=function(){Handler.update()},window.onwheel=function(e){ScrollBar.onWheel(e)},window.addEventListener("popstate",function(e){Pages.popstate(e)}),Pages.parseURL()}this.addThisHandlerToStack&&Handler.activeHandlers.push(this),Handler.instances.push(this),Handler.update(),Css.update()}static byLabel(e){for(let t in Handler.instances)if(Handler.instances[t].label==e)return Handler.instances[t]}pop(){return Handler.pop(this)}toTop(){let e=Handler.activeHandlers.indexOf(this);e>-1&&e!=Handler.activeHandlers.length-1&&(Handler.activeHandlers.splice(e,1),Handler.activeHandlers.push(this),Handler.update())}static pop(e=Handler.activeHandlers[Handler.activeHandlers.length-1]){let t=Handler.activeHandlers.indexOf(e),l=void 0;return-1!=t&&(l=Handler.activeHandlers[t],Handler.update([e],t,!0),Handler.activeHandlers.splice(t,1)),l}static screensizeToCoord(e,t){let l=pf.viewport();e.coord.copy(t,t,l[0]-2*t,l[1]-2*t,Handler.currentZindex)}static update(e=Handler.activeHandlers,t=0,l=!1){Handler.renderAgain=!1,Pages.activePages=[],Handler.currentZindex=Handler.handlerZindexStart+Handler.handlerZindexIncrement*t;for(let s=0;s<e.length;s++){let i=e[s];i.preRenderCallback&&i.preRenderCallback(i),i.coord?i.rootCell.coord.copy(i.coord):Handler.screensizeToCoord(i.rootCell,i.handlerMargin),i.controlledBySomething?i.rootCell.coord.copyWithin(i.rootCell.coord):i.rootCell.coord.copyWithin(!0),Handler.renderDisplayCell(i.rootCell,void 0,void 0,l),t+=1,Handler.currentZindex=Handler.handlerZindexStart+Handler.handlerZindexIncrement*t,i.postRenderCallback&&i.postRenderCallback(i)}Pages.activePages.length&&Pages.applyOnclick(),Observe.update(),Handler.renderAgain&&console.log("REDNDER AGAIN!")}static renderDisplayCell(e,t,l,s){e.preRenderCallback&&e.preRenderCallback(e,t,l,s),s&&Observe.derender(e);let i=e.pages;if(i){Pages.activePages.push(i);let s=i.eval();s!=i.previousPage&&(i.displaycells[i.previousPage].coord.copy(e.coord),Handler.renderDisplayCell(i.displaycells[i.previousPage],t,l,!0),i.currentPage=i.previousPage=s,Pages.pushHistory()),i.displaycells[s].coord.copy(e.coord),Handler.renderDisplayCell(i.displaycells[s],t,l,!1),i.currentPage=s,i.addSelected()}else{let i=e.htmlBlock,r=e.displaygroup,n=e.overlays;if(i&&Handler.renderHtmlBlock(e,s,t),r&&(r.coord.copy(e.coord),r&&i&&(Handler.currentZindex+=Handler.zindexIncrement,r.coord.copy(e.coord,pf.uis0(i.marginLeft),pf.uis0(i.marginTop),pf.uis0(i.marginRight),pf.uis0(i.marginBottom))),Handler.renderDisplayGroup(e,s)),n.length)for(let i of n)i.renderOverlay(e,t,l,s)}e.postRenderCallback&&e.postRenderCallback(e,t,l,s)}static renderDisplayGroup(e,t){let l,s,i=e.displaygroup,r=i.ishor,n=i.coord,o=i.cellArray.length,a=r?i.marginHor*(o-1):i.marginVer*(o-1),h=r?n.width-a:n.height-a,c=i.totalPx(),d=h-c,p=0,u=0,f=d,g=i.overlay;if(d<0){g||(i.overlay=new Overlay("ScrollBar",`${i.label}_ScrollBar`,i,c,h)),i.overlay.renderOverlay(e,i,0,!1);let t=i.coord,l=i.overlay.returnObj,s=l.scrollWidth;t.width-=r?0:s,t.within.width-=r?0:s,t.height-=r?s:0,t.within.height-=r?s:0}else g&&g.currentlyRendered&&i.overlay.renderOverlay(e,i,0,!0);let y,b,m=i.coord.x,w=i.coord.y;i.overlay&&(i.offset=i.overlay.returnObj.offset,m-=r?i.offset:0,w-=r?0:i.offset);for(let e=0;e<o;e++){let o=i.cellArray[e];pf.isTypePercent(o.dim)&&(u=pf.percentAsNumber(o.dim),p+=u,p<=100.01?(s=Math.round(d*u/100),f-=s):s=f),l=pf.isTypePx(o.dim)?pf.pxAsNumber(o.dim):s,y=r?l:n.width,b=r?n.height:l,o.coord.replace(m,w,y,b,Handler.currentZindex),o.coord.copyWithin(i.coord),Handler.renderDisplayCell(o,i,e,t),m+=r?y+i.marginHor:0,w+=r?0:b+i.marginVer}}static renderHtmlBlock(e,t=!1,l){let s=e.htmlBlock,i=pf.elExists(e.label),r=!!i;t=e.coord.derender(t);let n=""==s.css.trim()&&""==s.innerHTML.trim()&&0==Object.keys(s.attributes).length&&!Handler.renderNullObjects;if(t||n)r&&i.remove(),s.el=void 0;else{r||(i=document.createElement(s.tag)),pf.setAttrib(i,"id",e.label),s.css.trim()&&pf.setAttrib(i,"class",s.css),Handler.renderHtmlAttributes(i,s,e.label),i.innerHTML!=s.innerHTML&&(i.innerHTML=s.innerHTML),r||(document.body.appendChild(i),s.el=i,s.events&&s.events.applyToHtmlBlock(s));let t=e.coord.newAsAttributeString();i.style.cssText!=t&&(i.style.cssText=t)}}static renderHtmlAttributes(e,t,l){for(let s in t.attributes){let i=t.attributes[s];"class"==s&&(i+=" "+t.css),"id"==s&&(i=l),pf.setAttrib(e,s,i)}pf.setAttrib(e,"llm","")}}Handler.handlerMarginDefault=0,Handler.firstRun=!0,Handler.instances=[],Handler.activeHandlers=[],Handler.defaults={label:function(){return`handler_${pf.pad_with_zeroes(Handler.activeHandlers.length)}`},cssString:" ",addThisHandlerToStack:!0,controlledBySomething:!1},Handler.argMap={string:["label"],number:["handlerMargin"],Coord:["coord"],function:["preRenderCallback","postRenderCallback"],boolean:["addThisHandlerToStack","controlledBySomething"]},Handler.renderNullObjects=!1,Handler.argCustomTypes=[],Handler.handlerZindexStart=1,Handler.zindexIncrement=1,Handler.handlerZindexIncrement=100;class Css{constructor(...e){Css.instances.push(this),mf.applyArguments("Css",e,Css.defaults,Css.argMap,this),null==this.cssObj&&(this.cssObj=this.makeObj(),this.css=this.makeString()),this.cssHover&&(this.cssHoverObj=this.makeObj(this.cssHover),this.cssHover=this.makeString(this.cssHoverObj,"hover")),this.cssSelect&&(this.cssSelectObj=this.makeObj(this.cssSelect),this.cssSelect=this.makeString(this.cssSelectObj,"","Selected"))}static byLabel(e){for(let t in Css.instances)if(Css.instances[t].classname==e)return Css.instances[t]}makeString(e=this.cssObj,t="",l=""){let s=`${this.isClassname?".":""}${this.classname}${l}${t?":"+t:""} {\n`;for(let t in e)s+=`  ${t}:${e[t]};\n`;return s+="}",s}makeObj(e=this.css){let t={};e.indexOf("{")>-1&&(e=e.split("{")[1],e=e.split("}")[0]);let l,s,i=e.split(";");for(let e of i)l=e.indexOf(":"),l>-1&&(s=e.split(":"),t[s[0].trim()]=s[1].trim());return t}static byname(e){for(let t of Css.instances)if(t.css==e)return t}static update(){let e=document.getElementById(Css.elementId),t=!0;e||(t=!1,e=document.createElement("style")),pf.setAttrib(e,"id",Css.elementId);let l="\n";for(let e of Css.instances)e.css&&(l+=e.css+"\n"),e.cssHover&&(l+=e.cssHover+"\n"),e.cssSelect&&(l+=e.cssSelect+"\n");e.innerHTML=l,t||document.getElementsByTagName("head")[0].appendChild(e)}}Css.elementId="llmStyle",Css.instances=[],Css.defaults={css:function(){return`Css_${pf.pad_with_zeroes(Css.instances.length)}`},isClassname:!0},Css.argMap={string:["classname","css","cssHover","cssSelect"],boolean:["isClassname"]},Css.deleteOnFirstRunClassname=".remove";class DefaultTheme{}DefaultTheme.advisedDiv=new Css("div[llm]","position:absolute;",!1),DefaultTheme.advisedBody=new Css("body","overflow: hidden;",!1),DefaultTheme.context=css("contxt","background-color:white;color: black;outline-style: solid;outline-width: 1px;","contxt:hover","background-color:black;color: white;outline-style: solid;outline-width: 1px;"),Css.theme=DefaultTheme;class Pages{constructor(...e){Pages.instances.push(this);let t=pf.sortArgs(e,"Pages");mf.applyArguments("Pages",e,Pages.defaults,Pages.argMap,this),t.DisplayCell?this.displaycells=t.DisplayCell:pf.errorHandling("Pages Requires at least one DisplayCells")}static byLabel(e,t=Pages.instances){for(let t in Pages.instances)if(Pages.instances[t].label==e)return Pages.instances[t]}eval(){return this.evalFunction(this)}evalCell(){return this.displaycells[this.eval()]}setPage(e){e!=this.currentPage&&(this.currentPage=e,Handler.update())}addSelected(e=this.currentPage){let t,l,s=document.querySelectorAll(`[pagebutton='${this.label}|${e}']`);for(let e=0;e<s.length;e++)if(t=s[e],l=t.getAttribute("select"),l)pf.setAttrib(t,"class",l);else{let e=t.getAttribute("class");Css.byLabel(e).cssSelect&&pf.setAttrib(t,"class",e+"Selected")}}static setPage(e,t){Pages.byLabel(e).setPage(t)}static applyOnclick(){let e,t=document.querySelectorAll("[pagebutton]");for(let l=0;l<t.length;l++)e=t[l],e.onclick=function(e){Tree.onclick.bind(this)(e)}}indexByName(e){for(let t=0;t<this.displaycells.length;t++){const l=this.displaycells[t];if(l.label==e)return t}return-1}static button(e,t){return{attributes:{pagebutton:`${e}|${t}`}}}static parseURL(e=window.location.href){let t=pf.parseURLParams(e);if(t)for(let e in t){let l=Pages.byLabel(e);l&&(l.currentPage=t[e])}}static pushHistory(){let e=window.location.href.split("?")[0],t="?";for(const l of Pages.activePages)l.currentPage&&(e+=`${t}${l.label}=${l.currentPage}`,t="&");history.pushState(null,null,e)}static popstate(e){for(let e=0;e<Pages.activePages.length;e++){const t=Pages.activePages[e];t.currentPage=0}Pages.parseURL(),Handler.update()}}Pages.activePages=[],Pages.instances=[],Pages.defaults={label:function(){return`Pages_${pf.pad_with_zeroes(Pages.instances.length)}`},currentPage:0,previousPage:0,evalFunction:function(e){return e.currentPage}},Pages.argMap={string:["label"],number:["currentPage"],Function:["evalFunction"],dim:["dim"]};class Drag{constructor(...e){this.onDown=function(){},this.onMove=function(){},this.onUp=function(){},this.isDown=!1,Drag.instances.push(this);let t=pf.sortArgs(e,"Drag");if(mf.applyArguments("Drag",e,Drag.defaults,Drag.argMap,this),"Array"in t){let e=t.Array[0];this.onDown=e[0],this.onMove=e[1],this.onUp=e[2]}"HTMLDivElement"in t&&(this.el=t.HTMLDivElement[0]);let l=this;this.el.onmousedown=function(e){l.onDown(),l.isDown=!0,l.mousePos={x:e.clientX,y:e.clientY},window.addEventListener("selectstart",Drag.disableSelect),window.onmousemove=function(e){l.mouseDiff={x:e.clientX-l.mousePos.x,y:e.clientY-l.mousePos.y},l.onMove(l.mouseDiff)},window.onmouseup=function(e){l.reset(),l.onUp(l.mouseDiff)}}}static byLabel(e){for(let t in Drag.instances)if(Drag.instances[t].label==e)return Drag.instances[t]}reset(){window.onmousemove=function(){},window.onmouseup=function(){},window.removeEventListener("selectstart",Drag.disableSelect),this.isDown=!1}static disableSelect(e){e.preventDefault()}}Drag.instances=[],Drag.defaults={label:function(){return`Drag_${pf.pad_with_zeroes(Drag.instances.length)}`}},Drag.argMap={string:["label"]};class Swipe{constructor(...e){Swipe.instances.push(this);let t=pf.sortArgs(e,"Swipe"),l=pf.ifObjectMergeWithDefaults(t,Swipe.defaults),s=pf.retArgsMapped(t,l,Swipe.argMap);mf.modifyClassProperties(s,this)}}Swipe.swipeDistance=50,Swipe.elementId="llmSwipe",Swipe.instances=[],Swipe.defaults={label:function(){return`Swipe_Instance_${pf.pad_with_zeroes(Swipe.instances.length)}`},swipeDistance:Swipe.swipeDistance},Swipe.argMap={string:["label"],number:["swipeDistance"]};class Hold{constructor(...e){this.onDown=function(){},this.event=function(){},this.onUp=function(){},this.isDown=!1,Hold.instances.push(this);let t=pf.sortArgs(e,"Hold");mf.applyArguments("Hold",e,Hold.defaults,Hold.argMap,this),"HTMLDivElement"in t&&(this.el=t.HTMLDivElement[0]);let l=this;this.el.onmousedown=function(e){l.onDown(),l.isDown=!0,l.doOnclick&&l.event(),setTimeout(function(){Hold.start(l)},l.startTime),window.onmouseup=function(e){l.onUp(),l.isDown=!1}}}static byLabel(e){for(let t in Hold.instances)if(Hold.instances[t].label==e)return Hold.instances[t]}static start(e){e.isDown&&(e.event(),setTimeout(function(){Hold.start(e)},e.repeatTime))}}Hold.instances=[],Hold.defaults={label:function(){return`Hold_${pf.pad_with_zeroes(Hold.instances.length)}`},startTime:1e3,repeatTime:100,doOnclick:!0},Hold.argMap={string:["label"]};class Overlay{constructor(...e){Overlay.instances.push(this),this.label=`Overlay_${pf.pad_with_zeroes(Overlay.instances.length)}`,this.sourceClassName=e.shift(),this.returnObj=new Overlay.classes[this.sourceClassName](...e)}static byLabel(e){for(let t in Overlay.instances)if(Overlay.instances[t].label==e)return Overlay.instances[t]}renderOverlay(e,t,l,s){this.currentlyRendered=!s,this.returnObj.render(e,t,l,s)}}Overlay.instances=[],Overlay.classes={};class DragBar{constructor(...e){let t=this;this.parentDisplaycell;DragBar.instances.push(this);pf.sortArgs(e,"DragBar");mf.applyArguments("DragBar",e,DragBar.defaults,DragBar.argMap,this),this.displaycell=I(`${this.label}_dragbar`,"",events({ondrag:{onDown:function(e){pf.isTypePercent(t.parentDisplaycell.dim)&&t.parentDisplaygroup.percentToPx(t.parentDisplaycell),t.startpos=pf.pxAsNumber(t.parentDisplaycell.dim)},onMove:function(e){let l=t.startpos+(t.ishor?e.x:e.y)*(t.isLast?-1:1);l>t.max&&(l=t.max),l<t.min&&(l=t.min),t.parentDisplaycell.dim=`${l}px`,Handler.update()}}}))}static byLabel(e){for(let t in DragBar.instances)if(DragBar.instances[t].label==e)return DragBar.instances[t]}render(e,t,l,s){this.parentDisplaygroup||(this.parentDisplaygroup=t);let i=this,r=i.displaycell,n=t.ishor;i.ishor=n;let o=i.pxsize?i.pxsize:n?t.marginHor:t.marginVer,a=l==t.cellArray.length-1;i.isLast=a;let h=e.coord,c=n?a?h.x-o:h.x+h.width:h.x,d=n?h.y:a?h.y-o:h.y+h.height,p=n?o:h.width,u=n?h.height:o;r.coord.replace(c,d,p,u,Handler.currentZindex+Handler.zindexIncrement),r.htmlBlock.css=n?i.horcss.classname:i.vercss.classname,t.coord.isCoordCompletelyOutside(r.coord)&&(s=!0),Handler.renderDisplayCell(r,t,void 0,s)}}DragBar.horCss=css("db_hor","background-color:black;cursor: ew-resize;"),DragBar.verCss=css("db_ver","background-color:black;cursor: ns-resize;"),DragBar.instances=[],DragBar.defaults={label:function(){return`DragBar_${pf.pad_with_zeroes(DragBar.instances.length)}`},horcss:DragBar.horCss,vercss:DragBar.verCss},DragBar.argMap={string:["label"],DisplayCell:["parentDisplaycell"],number:["min","max","pxsize"],Css:["horcss","vercss"]},Overlay.classes.DragBar=DragBar;class ScrollBar{constructor(...e){ScrollBar.instances.push(this),mf.applyArguments("ScrollBar",e,ScrollBar.defaults,ScrollBar.argMap,this),this.build()}static byLabel(e){for(let t in ScrollBar.instances)if(ScrollBar.instances[t].label==e)return ScrollBar.instances[t]}build(){let e=this,t=this.arrowOffset,l=this.scrollWidth,s=l-t,i=l/2;this.leftArrow=I(this.label+"_Left",`<svg height="${l}" width="${l}">\n            <polygon points="${t},${i} ${s},${t} ${s},${s} ${t},${i}"\n            style="fill:black;stroke:black;stroke-width:1" />\n            </svg>`,`${l}px`,"whiteBG",events({onhold:{event:function(t){e.clickLeftorUp(t)}}})),this.upArrow=I(this.label+"_Up",`<svg height="${l}" width="${l}">\n            <polygon points="${t},${s} ${i},${t} ${s},${s} ${t},${s}"\n            style="fill:black;stroke:black;stroke-width:1" />\n            </svg>`,`${l}px`,"whiteBG",events({onhold:{event:function(t){e.clickLeftorUp(t)}}})),this.prePaddle=I(this.label+"_Pre","","whiteBG",events({onclick:function(t){e.clickPageLeftorUp(t)}})),this.paddle=I(this.label+"_Paddle","","blackBG",events({ondrag:{onDown:function(){e.offsetAtDrag=e.offset},onMove:function(t){e.dragging(t)}}})),this.postPaddle=I(this.label+"_Post","","whiteBG",events({onclick:function(t){e.clickPageRightOrDown(t)}})),this.rightArrow=I(this.label+"_Right",`<svg height="${l}" width="${l}">\n            <polygon points="${t},${t} ${s},${i} ${t},${s} ${t},${t}"\n            style="fill:black;stroke:black;stroke-width:1" />\n            </svg>`,`${l}px`,"whiteBG",events({onhold:{event:function(t){e.clickRightOrDown(t)}}})),this.downArrow=I(this.label+"_down",`<svg height="${l}" width="${l}">\n            <polygon points="${t},${t} ${s},${t} ${i},${s} ${t},${t}"\n            style="fill:black;stroke:black;stroke-width:1" />\n            </svg>`,`${l}px`,"whiteBG",events({onhold:{event:function(t){e.clickRightOrDown(t)}}})),this.ishor=this.displaygroup.ishor,this.displaycell=h(this.ishor,this.ishor?this.leftArrow:this.upArrow,this.prePaddle,this.paddle,this.postPaddle,this.ishor?this.rightArrow:this.downArrow,this.label)}clickLeftorUp(e,t=1){this.offset-=this.offsetPixelRatio*t,this.offset<0&&(this.offset=0),Handler.update()}clickRightOrDown(e,t=1){this.offset+=this.offsetPixelRatio*t,this.offset>this.maxOffset&&(this.offset=this.maxOffset),Handler.update()}clickPageLeftorUp(e){this.offset-=this.displayedFixedPx,this.offset<0&&(this.offset=0),Handler.update()}clickPageRightOrDown(e){this.offset+=this.displayedFixedPx,this.offset>this.maxOffset&&(this.offset=this.maxOffset),Handler.update()}dragging(e){let t=this.ishor?e.x:e.y,l=this.offsetAtDrag+t*this.offsetPixelRatio;l<0&&(l=0),l>this.maxOffset&&(l=this.maxOffset),this.offset=l,Handler.update()}render(e,t,l,s){this.parentDisplaygroup||(this.parentDisplaygroup=t);let i=this.displaygroup.coord,r=this.ishor?i.within.x:i.within.x+i.within.width-this.scrollWidth,n=this.ishor?i.within.width:this.scrollWidth,o=this.ishor?i.within.y+i.within.height-this.scrollWidth:i.within.y,a=this.ishor?this.scrollWidth:i.within.height;this.displaycell.coord.replace(r,o,n,a);let h=this.displaycell.displaygroup.cellArray[1],c=this.displaycell.displaygroup.cellArray[2],d=this.displaycell.displaygroup.cellArray[3],p=this.displaygroup.totalPx(),u=this.displayedFixedPx=this.ishor?n:a;this.maxOffset=p-u,this.offset>this.maxOffset&&(this.offset=this.maxOffset),this.offset<0&&(this.offset=0),this.offsetPixelRatio=p/u;let f=Math.round(this.offset/p*100),g=Math.round(u/p*100),y=100-g-f;h.dim=`${f}%`,c.dim=`${g}%`,d.dim=`${y}%`,Handler.currentZindex+=2*Handler.zindexIncrement,this.currentlyRendered=!s,Handler.renderDisplayCell(this.displaycell,void 0,void 0,s),Handler.currentZindex-=2*Handler.zindexIncrement}static distOfMouseFromWheel(e,t){let l=e.displaygroup.ishor,s=e.displaycell,i=s.coord,r=t.clientX,n=t.clientY,o=0;return l?(n<i.y&&(o=i.y-n),n>i.y+i.height&&(o=n-(i.y+i.height))):(r<i.x&&(o=i.x-r),r>i.x+i.width&&(o=r-(i.x+i.width))),o}static onWheel(e){let t,l,s=1e5;for(let i of ScrollBar.instances)i.currentlyRendered&&(i.parentDisplaygroup.coord.isPointIn(e.clientX,e.clientY)||i.displaycell.coord.isPointIn(e.clientX,e.clientY))&&(l=ScrollBar.distOfMouseFromWheel(i,e),(!t||l<s)&&(s=l,t=i));t&&(e.deltaY>0&&t.clickRightOrDown(e,ScrollBar.scrollWheelMult*e.deltaY/100),e.deltaY<0&&t.clickLeftorUp(e,-ScrollBar.scrollWheelMult*e.deltaY/100))}}ScrollBar.instances=[],ScrollBar.whiteBG=css("whiteBG","background-color:white;outline: 1px solid black;outline-offset: -1px;"),ScrollBar.blackBG=css("blackBG","background-color:black;color:white;cursor: -webkit-grab; cursor: grab;"),ScrollBar.defaults={label:function(){return`ScrollBar_${pf.pad_with_zeroes(ScrollBar.instances.length)}`},offset:0,displayAtEnd:!0,scrollWidth:15,currentlyRendered:!0,arrowOffset:2},ScrollBar.argMap={string:["label"],DisplayGroup:["displaygroup"],number:["fixedPixels","viewingPixels","scroolWidth"],boolean:["displayAtEnd"]},ScrollBar.scrollWheelMult=4,ScrollBar.triggerDistance=40,Overlay.classes.ScrollBar=ScrollBar;class Context{constructor(...e){this.coord=new Coord,Context.instances.push(this),mf.applyArguments("Context",e,Context.defaults,Context.argMap,this),this.menuObj||(this.menuObj=Context.defaultObj),this.height=Object.keys(this.menuObj).length*this.cellheight,this.buildCell()}static byLabel(e){for(let t in Context.instances)if(Context.instances[t].label==e)return Context.instances[t]}buildCell(){let e,t=this,l=[],s=Object.keys(this.menuObj).length,i=0;this.displaycell=v({cellArray:[]});for(let r in this.menuObj){let n=this.menuObj[r]
;"function"==typeof n?l.push(I(i==s-1?"100%":`${this.cellheight}px`,{innerHTML:r},this.css,events({onclick:function(e){n(e),t.popAll()}}))):(e=new Context({menuObj:n,width:this.width,cellheight:this.cellheight,css:this.css,parentContext:this}),e.launchcell=I(i==s-1?"100%":`${this.cellheight}px`,{innerHTML:r},this.css,events({onmouseover:function(){let l=t.coord;e.handler||e.render(void 0,l.x+l.width-Context.subOverlapPx,l.y+t.cellheight*(i-2)-Context.subOverlapPx)}})),l.push(e.launchcell)),i+=1}this.displaycell.displaygroup.cellArray=l}popAll(){this.pop(),this.parentContext?this.parentContext.popAll():window.onmousemove=function(){}}pop(){this.handler.pop(),this.handler=void 0,this.parentContext&&(Context.lastRendered=this.parentContext)}managePop(e){let t=e.clientX,l=e.clientY,s=!this.displaycell.coord.isPointIn(t,l);s&&this.launchcell&&this.launchcell.coord.isPointIn(t,l)&&(s=!1);let i=this;s&&(this.parentContext?window.onmousemove=function(e){i.parentContext.managePop(e)}:window.onmousemove=function(){},this.pop())}render(e,t=0,l=0){e&&(t=e.clientX-Context.subOverlapPx,l=e.clientY-Context.subOverlapPx),this.coord.replace(t,l,this.width,this.height),this.handler=H(this.displaycell,this.coord);let s=this;window.onmousemove=function(e){s.managePop(e)},Context.lastRendered=this}hMenuBarx(){return this.launchcell.coord.x}hMenuBary(){return this.launchcell.coord.y+this.launchcell.coord.height}vMenuBarx(){return this.launchcell.coord.x+this.launchcell.coord.width}vMenuBary(){return this.launchcell.coord.y}}Context.subOverlapPx=4,Context.instances=[],Context.defaultMenuBarCss=css("menuBar","background-color:white;color: black;"),Context.defaultMenuBarHover=css("menuBar:hover","background-color:black;color: white;"),Context.defaultMenuBarNoHoverCss=css("menuBarNoHover","background-color:white;color: black;"),Context.defaultObj={one:function(){console.log("one")},two:function(){console.log("two")},three:function(){console.log("three")}},Context.defaults={label:function(){return`Context_${pf.pad_with_zeroes(Context.instances.length)}`},width:100,cellheight:25,css:Css.theme.context},Context.argMap={string:["label"],number:["width","cellheight"]};let context=function(...e){let t=new Context(...e);return function(e){return t.render(e),!1}},hMenuBar=function(...e){let t=new Context(...e);return function(e){return Context.lastRendered&&Context.lastRendered.handler&&Context.lastRendered.popAll(),t.render(void 0,t.hMenuBarx(),t.hMenuBary()),!1}},vMenuBar=function(...e){let t=new Context(...e);return function(e){return t.render(void 0,t.vMenuBarx(),t.vMenuBary()),!1}};class Modal{constructor(...e){Modal.instances.push(this);let t=pf.sortArgs(e,"Modal");if(mf.applyArguments("Modal",e,Modal.defaults,Modal.argMap,this),"number"in t){this.coord||(this.coord=new Coord);let e,l,s,i,r=t.number,n=r.length;if(2==n){let t=pf.viewport();s=r[0],i=r[1],e=(t[0]-s)/2,l=(t[1]-i)/2,this.coord.replace(e,l,s,i)}else if(4==n){this.coord.replace(r[0],r[1],r[2],r[3]);let e=pf.viewport();this.coord.within.x=0,this.coord.within.y=0,this.coord.within.width=e[0],this.coord.within.height=e[1]}}else if(!this.coord){let e=pf.viewport();this.coord=new Coord(Math.round(e[0]/4),Math.round(e[1]/4),Math.round(e[0]/2),Math.round(e[1]/2)),this.coord.within.x=0,this.coord.within.y=0,this.coord.within.width=e[0],this.coord.within.height=e[1]}this.minWidth||(this.minWidth=this.coord.width),this.minHeight||(this.minHeight=this.coord.height),this.bodyCell||(this.bodyCell=I(this.label,this.innerHTML,Modal.bodyCss)),this.footerTitle&&(this.showFooter=!0),this.build()}static byLabel(e){for(let t in Modal.instances)if(Modal.instances[t].label==e)return Modal.instances[t]}setContent(e){this.bodyCell.htmlBlock.innerHTML=e,Handler.update()}buildHeader(){let e=this;this.headerCell||(this.headerCell=h(`${this.label}_header`,`${this.headerHeight}px`,I(`${this.label}_headerTitle`,this.headerTitle,Modal.headerCss,events({ondrag:{onDown:function(){return Modal.startMoveModal(e.handler)},onMove:function(t){return Modal.moveModal(e.handler,t)}}}))),this.showClose&&this.headerCell.displaygroup.cellArray.push(I({innerHTML:`<svg viewPort="0 0 ${this.headerHeight} ${this.headerHeight}" version="1.1"\n                              xmlns="http://www.w3.org/2000/svg" style="width: ${this.headerHeight}px; height: ${this.headerHeight}px;">\n                              <line x1="3" y1="${this.headerHeight-3}" \n                                x2="${this.headerHeight-3}" y2="3" \n                                stroke="black" \n                                stroke-width="2"/>\n                              <line x1="3" y1="3" \n                                x2="${this.headerHeight-3}" y2="${this.headerHeight-3}" \n                                stroke="black" \n                                stroke-width="2"/>\n                              </svg>`},Modal.closeCss,`${this.headerHeight}px`,events({onclick:function(){e.hide()}}))))}buildFooter(){this.footerCell||(this.footerCell=h(`${this.label}_footer`,`${this.footerHeight}px`,I(`${this.label}_footerTitle`,this.footerTitle,Modal.footerCss)))}buildOptions(){this.optionsCell||(this.optionsCell=h(`${this.label}_options`,`${this.optionsHeight}px`,I(`${this.label}_okButton`,`<button onclick="Modal.byLabel('${this.label}').hide()" >OK</button>`,Modal.optionsCss)))}buildFull(){this.fullCell=v(this.bodyCell),this.showHeader&&this.fullCell.displaygroup.cellArray.unshift(this.headerCell),this.showOptions&&this.fullCell.displaygroup.cellArray.push(this.optionsCell),this.showFooter&&this.fullCell.displaygroup.cellArray.push(this.footerCell)}build(){this.buildHeader(),this.buildFooter(),this.buildOptions(),this.buildFull(),this.handler=H(`${this.label}_h`,v(this.fullCell),this.coord,!1)}show(){Handler.activeHandlers.push(this.handler),Handler.update()}hide(){this.handler.pop()}static startMoveModal(e){e.toTop(),Modal.x=e.coord.x,Modal.y=e.coord.y}static moveModal(e,t){let l=pf.viewport(),s=Modal.x+t.x;s<0&&(s=0),s+e.coord.width>l[0]&&(s=l[0]-e.coord.width),e.coord.x=s;let i=Modal.y+t.y;i<0&&(i=0),i+e.coord.height>l[1]&&(i=l[1]-e.coord.height),e.coord.y=i,Handler.update()}}Modal.instances=[],Modal.headerCss=css("HeaderTitle","background-color:blue;color:white;text-align: center;border: 1px solid black;cursor: -webkit-grab; cursor: grab;"),Modal.footerCss=css("FooterTitle","background-color:white;color:black;border: 1px solid black;"),Modal.closeCss=css("Close","background-color:white;color:black;border: 1px solid black;font-size: 20px;"),Modal.closeCssHover=css("Close:hover","background-color:red;color:white;border: 1px solid black;font-size: 20px;"),Modal.bodyCss=css("ModalBody","background-color:white;border: 1px solid black;"),Modal.optionsCss=css("ModalOptions","background-color:white;border: 1px solid black;display: flex;justify-content: center;align-items: center;"),Modal.defaults={label:function(){return`Modal_${pf.pad_with_zeroes(Modal.instances.length)}`},showHeader:!0,showFooter:!1,resizeable:!0,showClose:!0,showOptions:!0,headerHeight:20,footerHeight:20,headerTitle:"",innerHTML:"",optionsHeight:30},Modal.argMap={string:["label","headerTitle","footerTitle",["innerHTML"]],DisplayCell:["bodyCell","headerCell","footerCell","optionsCell"],Coord:["coord"]};class TreeNode{constructor(...e){this.collapsed=!1,this.nodeCellArray=[],TreeNode.instances.push(this),mf.applyArguments("TreeNode",e,TreeNode.defaults,TreeNode.argMap,this),this.labelCell.htmlBlock&&(this.labelCell.htmlBlock.hideWidth=this.labelCell.coord.hideWidth=!0),this.labelCell&&!this.label&&(this.label=this.labelCell.label)}static byLabel(e){for(let t in TreeNode.instances)if(TreeNode.instances[t].label==e)return TreeNode.instances[t]}visibleChildren(e=0){if(!this.collapsed&&this.children)for(let t of this.children)e+=t.visibleChildren(1);return e}addDisplayCells(e=[],t=!0){if(t||e.push(this.horizontalDisplayCell),!this.collapsed&&this.children)for(let t of this.children)e=t.addDisplayCells(e,!1);return e}}TreeNode.instances=[],TreeNode.defaults={},TreeNode.argMap={DisplayCell:["labelCell"],string:["label"],Array:["children"],boolean:["collapsed"]};class Props{constructor(...e){Props.instances.push(this);let t=pf.sortArgs(e,"Prop");mf.applyArguments("Prop",e,Props.defaults,Props.argMap,this),"DisplayCell"in t&&(this.cellArray=t.DisplayCell)}static byLabel(e){for(let t in Props.instances)if(Props.instances[t].label==e)return Props.instances[t]}}Props.instances=[],Props.defaults={label:function(){return`Prop_${pf.pad_with_zeroes(Props.instances.length)}`}},Props.argMap={string:["label"]};class Tree{constructor(...e){this.css="",Tree.instances.push(this);let t=pf.sortArgs(e,"Tree");if(mf.applyArguments("Tree",e,Tree.defaults,Tree.argMap,this),this.parentDisplayCell||(this.parentDisplayCell=new DisplayCell(`TreeRoot_${this.label}`)),"Css"in t)for(let e of t.Css)this.css=(this.css+" "+e.classname).trim();"string"in t&&t.string.length>1&&(this.css+=" "+t.string.splice(1).join(" "));let l=v(`${this.label}_rootV`,this.parentDisplayCell.dim,2,2),s=l.displaygroup.cellArray;this.parentDisplayCell.displaygroup=new DisplayGroup(`${this.label}_rootH`,l),this.t_instance&&!this.rootTreeNode&&(this.rootTreeNode=Tree.autoLabelTreenodes(this.label,this.t_instance)),this.rootTreeNode||(this.rootTreeNode=Tree.defaultObj),this.parentDisplayCell.preRenderCallback=function(e,t,l,s){if(!Handler.firstRun){let t,l,s=0,i=document.querySelectorAll("[treenode]");for(let e of i)t=e.getBoundingClientRect(),l=t.x+t.width,l>s&&(s=l);let r=e.coord.x+e.coord.width,n=e.coord.x;e.displaygroup.cellArray[0].dim=`${r>s?r-n:s-n}px`}},this.buildTreeNode(this.rootTreeNode,s)}static byLabel(e){for(let t in Tree.instances)if(Tree.instances[t].label==e)return Tree.instances[t]}drawSVG(e){let t=this.collapsePad,l=(this.cellHeight-this.collapseSize)/2+this.collapsePad,s=this.collapseSize-t,i=l+this.collapseSize-2*this.collapsePad,r=this.collapseSize/2,n=this.cellHeight/2,o=this.SVGColor;return`<svg height="${this.cellHeight}" width="${this.collapseSize}">`+(e?`<polygon points="${t},${l} ${s},${n} ${t},${i} ${t},${l}"`:`<polygon points="${t},${l} ${s},${l} ${r},${i} ${t},${l}"`)+`style="fill:${o};stroke:${o};stroke-width:1" />\n            </svg>`}toggleCollapse(e,t,l){e.collapsed=!e.collapsed,e.horizontalDisplayCell.displaygroup.cellArray[1].htmlBlock.innerHTML=this.drawSVG(e.collapsed);let s=this.parentDisplayCell.displaygroup.cellArray[0].displaygroup.cellArray,i=s.indexOf(e.horizontalDisplayCell);if(e.collapsed){for(let t of e.nodeCellArray)Handler.renderDisplayCell(t,void 0,void 0,!0);e.collapsed=!e.collapsed;let t=e.visibleChildren();e.collapsed=!e.collapsed,s.splice(i+1,t)}else s.splice(i+1,0,...e.addDisplayCells());Handler.update()}buildTreeNode(e=this.rootTreeNode,t,l=this.startIndent){let s=this,i=!!e.children&&!!e.children.length;if(e.labelCell.htmlBlock.attributes.treenode="",!e.labelCell.htmlBlock.css&&this.css.trim()&&(e.labelCell.htmlBlock.css=this.css.trim()),!e.labelCell.htmlBlock.events&&this.events&&(e.labelCell.htmlBlock.events=this.events),e.horizontalDisplayCell=h(I(e.label+"_spacer","",`${l}px`),I(e.label+"_svg",i?this.drawSVG(e.collapsed):"",`${this.collapseSize}px`,events({onclick:function(t){t.preventDefault(),s.toggleCollapse(e,t,this)},onmousedown:function(e){window.addEventListener("selectstart",Drag.disableSelect)},onmouseup:function(e){window.removeEventListener("selectstart",Drag.disableSelect)}})),e.labelCell,`${this.cellHeight}px`),t.push(e.horizontalDisplayCell),e.children){for(let t of e.children)this.buildTreeNode(t,e.nodeCellArray,l+this.indent);e.collapsed||pf.concatArray(t,e.nodeCellArray)}}render(e){}static autoLabelTreenodes(e,t){return Tree.autoLabel(t,e),Tree.makeTreeNodes(t)}static autoLabel(e,t){if(e.label=t,e.TreeNodeArguments[0].label=t,e.TreeNodeArguments.length>1){let l=e.TreeNodeArguments[1];for(let e=0;e<l.length;e++){const s=l[e];Tree.autoLabel(s,t+"_"+e)}}}static makeTreeNodes(e){let t,l,s=[],i=e.TreeNodeArguments[0];if(e.TreeNodeArguments.length>1){t=e.TreeNodeArguments[1];for(const e of t)s.push(Tree.makeTreeNodes(e));l=T(e.label,I(i.label,...i.Arguments),s)}else l=T(e.label,I(i.label,...i.Arguments));return l}static t(...e){return new t_(...e)}static i(...e){return new i_(...e)}static onclick(e){let t=this,l=t.getAttribute("pagebutton"),s=l.split("|"),i=s[0],r=s[1];if(Pages.setPage(i,parseInt(r)),HtmlBlock.byLabel(t.id).events&&HtmlBlock.byLabel(t.id).events.actions.onclick){var n=HtmlBlock.byLabel(t.id).events.actions.onclick.bind(t);n(e)}}}Tree.instances=[],Tree.defaultObj=T("Tree",I("Tree_TopDisplay","Top Display"),props(I("Tree_TopDisplay_prop1","prop1"),I("Tree_TopDisplay_prop2","prop2")),[T("Tree_child1",I("Tree_Child1ofTop","Child1ofTop"),[T("Tree_child1_1",I("Tree_Child1ofChild1","Child1ofChild1")),T("Tree_child1_2",I("Tree_Child2ofChild1","Child2ofChild1"))]),T("Tree_child2",I("Tree_Child2ofTop","Child2ofTop"))]),Tree.defaults={label:function(){return`Tree_${pf.pad_with_zeroes(Tree.instances.length)}`},cellHeight:20,SVGColor:"white",startIndent:0,indent:10,collapsePad:4,collapseSize:16},Tree.argMap={string:["label"],number:["cellHeight"],TreeNode:["rootTreeNode"],DisplayCell:["parentDisplayCell"],Events:["events"],t_:["t_instance"]},Overlay.classes.Tree=Tree;class i_{constructor(...e){this.Arguments=e}}class t_{constructor(...e){this.TreeNodeArguments=e}}class Observe{constructor(...e){Observe.instances.push(this);pf.sortArgs(e,"Observe");mf.applyArguments("Observe",e,Observe.defaults,Observe.argMap,this);let t=this,l=Handler.byLabel(t.label);l.coord||(l.coord=new Coord),-1==Handler.activeHandlers.indexOf(l)&&Handler.activeHandlers.push(l),this.parentDisplayCell.htmlBlock.el.onscroll=function(e){Observe.onScroll(e)},l.controlledBySomething=!0,this.parentDisplayCell.postRenderCallback=function(e,l,s,i=!1){let r=e.htmlBlock.el,n=e.coord,o=Handler.byLabel(t.label),a=o.coord,h=t.el.getBoundingClientRect();a.x=h.x,a.y=h.y,a.width=h.width,a.height=h.height,a.within.x=n.x,a.within.y=n.y,a.within.width=n.width-(r.scrollHeight>r.clientHeight?Observe.Os_ScrollbarSize:0),a.within.height=n.height-(r.scrollWidth>r.clientWidth?Observe.Os_ScrollbarSize:0)},Handler.update()}static byLabel(e){for(let t in Observe.instances)if(Observe.instances[t].label==e)return Observe.instances[t]}static derender(e){let t;for(let l=0;l<Observe.instances.length;l++){let s=Observe.instances[l];if(s.parentDisplayCell==e){t=Handler.byLabel(s.label);let l=Handler.activeHandlers.indexOf(t);l>-1&&Handler.activeHandlers.splice(l,1),e.postRenderCallback=function(){},Handler.update([t],0,!0);let i=Observe.instances.indexOf(s);Observe.instances.splice(i,1)}}}static onScroll(e){for(let e=0;e<Observe.instances.length;e++){const t=Observe.instances[e];t.parentDisplayCell.postRenderCallback(t.parentDisplayCell),Handler.update()}}static update(){let e=document.querySelectorAll("[parentof]"),t=[];for(let l=0;l<e.length;l++){let s=e[l],i=pf.getAttribs(s),r=i.parentof,n=Handler.byLabel(r);if(n&&(t.push(r),!Observe.byLabel(r))){let e,t=s.parentElement;for(;t&&!e;)e=DisplayCell.byLabel(t.id),t=t.parentElement;new Observe(r,s,e)}}}}Observe.instances=[],Observe.defaults={label:function(){return`Observe_${pf.pad_with_zeroes(Observe.instances.length)}`}},Observe.argMap={string:["label"],HTMLDivElement:["el"],DisplayCell:["parentDisplayCell"]},Observe.Os_ScrollbarSize=15;